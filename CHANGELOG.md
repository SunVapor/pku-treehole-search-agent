# 更新日志 (CHANGELOG)

## [v2.0.0] - 2026-02-23

### 🚀 新功能: 智能迭代检索（MCP-like Function Calling）

#### 主要特性
- **模式 2 升级**：从简单的"提取关键词→搜索一次"升级为"智能迭代检索"
- **LLM 自主决策**：LLM 自己决定何时搜索、搜索什么关键词
- **多轮迭代**：如果首次搜索结果不满意，LLM 可以自动再次搜索（使用不同关键词）
- **MCP 风格工具调用**：类似 Model Context Protocol，LLM 将搜索功能作为工具使用

#### 工作流程
1. LLM 分析用户问题
2. LLM 决定搜索策略（关键词）
3. 执行搜索，返回结果
4. LLM 评估信息充分性
5. 如需要，LLM 再次搜索（换用不同关键词）
6. 迭代直至信息充足（最多 3 次）
7. 综合所有搜索结果生成最终回答

#### 技术实现
- 新增 `_call_deepseek_with_tools()` 方法支持 function calling API
- 定义 `search_treehole` 作为 LLM 可调用的工具
- 实现迭代循环，处理 `tool_calls` 并反馈结果
- LLM 自主判断是否需要更多信息

#### 配置项
- 新增 `MAX_SEARCH_ITERATIONS` 配置（默认 3 次）
- 控制单次查询的最大搜索轮数

#### 实测效果
以"AI和机器学习相关课程推荐"为例：
- **第 1 次搜索**: "AI 机器学习 课程"
- **第 2 次搜索**: "人工智能 课程 推荐"
- **第 3 次搜索**: "AI引论 机器学习 课程测评"
- 最终找到 34 个不重复帖子，生成综合性回答

#### 适用场景
- 问题复杂，单一关键词覆盖不全
- 需要综合多方面信息
- 用户不确定精确关键词

---

## [v1.2.0] - 2026-02-23

### ✨ 优化评论处理和 Token 估算

#### Bug 修复
- **Token 估算不准确**：`smart_truncate_posts` 现在正确包含评论内容
- 避免超出 LLM 上下文限制

#### 新增功能
- **可配置评论数量**：`MAX_COMMENTS_PER_POST` 配置项
  - 支持 0（禁用评论）
  - 支持正整数（指定数量）
  - 支持 -1（无限制）
- 应用于模式 1 和模式 2

---

## [v1.1.0] - 2026-02-22

### 🤖 邮件机器人

#### 新增功能
- 远程邮件查询系统
- systemd 服务部署
- 非交互模式登录

#### Cookie 管理优化
- 统一 Cookie 存储位置：`~/.treehole_cookies.json`
- 支持非交互式环境运行

#### 项目重组
- 邮件机器人独立文件夹：`email_bot/`
- 完善的文档和部署脚本

---

## [v1.0.0] - 初始版本

### 核心功能
- 三种检索模式：手动、自动、课程测评
- 流式输出
- 搜索缓存
- 中文界面
